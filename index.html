<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>GDP per Capita PPP Explorer | PIB par habitant PPA</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(145deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);
  color:#f8fafc;min-height:100vh;-webkit-font-smoothing:antialiased}
.ctr{max-width:1140px;margin:0 auto;padding:12px 12px 40px}
.hdr{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.hdr-text{flex:1;min-width:0}
.hdr h1{font-size:20px;font-weight:700;line-height:1.2;letter-spacing:-.3px}
.hdr h1 span{color:#94a3b8;font-weight:400;font-size:13px;margin-left:6px}
.hdr .sub{color:#64748b;font-size:11px;line-height:1.4}
.lp{flex-shrink:0;display:flex;border-radius:6px;overflow:hidden;border:1px solid rgba(148,163,184,.25);background:rgba(30,41,59,.7)}
.lp button{padding:6px 10px;font-size:12px;font-weight:700;border:none;cursor:pointer;font-family:inherit;transition:all .15s;color:#64748b;background:transparent}
.lp button.on{color:#60a5fa;background:rgba(59,130,246,.15)}
.lp button:not(.on):hover{color:#94a3b8}

/* Selector panel */
.sel-toggle{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.sel-toggle .b{font-size:11px;padding:5px 10px}
.sel-count{font-size:11px;color:#64748b}
.sel-panel{background:rgba(30,41,59,.5);border:1px solid rgba(148,163,184,.12);border-radius:10px;
  padding:12px;margin-bottom:12px;display:none}
.sel-panel.open{display:block}
.grp-row{display:flex;gap:4px;flex-wrap:wrap;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid rgba(148,163,184,.08)}
.grp{padding:4px 10px;border-radius:5px;cursor:pointer;font-size:11px;font-weight:600;
  border:1px solid rgba(148,163,184,.2);background:rgba(30,41,59,.6);color:#94a3b8;
  font-family:inherit;transition:all .15s;white-space:nowrap}
.grp:hover{border-color:rgba(148,163,184,.4);color:#cbd5e1}
.grp.on{border-color:#3b82f6;background:rgba(59,130,246,.12);color:#60a5fa}
.chk-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:2px}
.chk-item{display:flex;align-items:center;gap:5px;padding:4px 6px;border-radius:4px;cursor:pointer;transition:background .15s;font-size:12px;color:#cbd5e1}
.chk-item:hover{background:rgba(59,130,246,.06)}
.chk-item input{accent-color:#3b82f6;width:14px;height:14px;cursor:pointer}
.chk-item.hi{background:rgba(59,130,246,.1);color:#60a5fa}

/* Buttons */
.b{padding:6px 14px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:600;
  border:1px solid rgba(148,163,184,.2);background:rgba(30,41,59,.6);color:#94a3b8;
  font-family:inherit;transition:all .2s;white-space:nowrap}
.b:hover{border-color:rgba(148,163,184,.4);color:#cbd5e1}
.b.on{border-color:#3b82f6;background:rgba(59,130,246,.15);color:#60a5fa}
.b.pri{border-color:#3b82f6;background:rgba(59,130,246,.2);color:#60a5fa}

/* Chart card */
.cc{background:rgba(30,41,59,.4);border-radius:12px;border:1px solid rgba(148,163,184,.1);padding:10px;position:relative}
canvas{display:block;width:100%!important}

/* Legend */
.lc{background:rgba(30,41,59,.4);border-radius:10px;border:1px solid rgba(148,163,184,.1);padding:10px 12px;margin-top:10px}
.lh{font-size:10px;color:#64748b;margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.7px}
.lg{display:flex;flex-wrap:wrap;gap:3px 10px}
.li{display:flex;align-items:center;gap:5px;cursor:pointer;padding:3px 6px;border-radius:4px;transition:all .2s;user-select:none}
.li:hover{background:rgba(59,130,246,.08)}
.li.on{background:rgba(59,130,246,.12)}
.li.dim{opacity:.28}
.ls{width:12px;height:3px;border-radius:2px;flex-shrink:0}
.ln{font-size:11px;color:#e2e8f0;white-space:nowrap}
.lv{font-size:10px;color:#64748b;font-family:monospace}

/* Tabs */
.tabs{display:flex;gap:0;margin-top:14px;border-bottom:1px solid rgba(148,163,184,.12)}
.tab{padding:10px 14px;font-size:12px;font-weight:600;cursor:pointer;color:#64748b;
  border:none;border-bottom:2px solid transparent;transition:all .2s;background:transparent;font-family:inherit}
.tab:hover{color:#94a3b8}
.tab.on{color:#60a5fa;border-bottom-color:#3b82f6}
.panel{display:none;padding:14px 4px}
.panel.show{display:block}

/* Analysis */
.ai{margin-bottom:18px}
.ai h3{font-size:14px;font-weight:600;color:#e2e8f0;margin-bottom:5px}
.ai p{font-size:13px;color:#94a3b8;line-height:1.7}
.an{font-size:11px;color:#64748b;line-height:1.5;font-style:italic;border-top:1px solid rgba(148,163,184,.1);padding-top:12px;margin-top:4px}
.about p{color:#94a3b8;font-size:13px;line-height:1.7;margin-bottom:12px}
.about p strong{color:#cbd5e1}
.about .src{color:#64748b;font-size:12px;line-height:1.6}
.about .src strong{color:#94a3b8}

/* Data table */
.tbl-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;font-size:12px}
thead th{position:sticky;top:0;background:#1e293b;color:#94a3b8;font-weight:600;font-size:11px;
  padding:8px 6px;text-align:right;cursor:pointer;border-bottom:1px solid rgba(148,163,184,.15);
  white-space:nowrap;user-select:none}
thead th:first-child{text-align:left;min-width:110px}
thead th:hover{color:#e2e8f0}
thead th .arr{font-size:9px;margin-left:2px;color:#3b82f6}
tbody td{padding:5px 6px;text-align:right;color:#cbd5e1;border-bottom:1px solid rgba(148,163,184,.04);font-family:monospace;font-size:11px}
tbody td:first-child{text-align:left;font-family:inherit;font-size:12px;color:#e2e8f0;font-weight:500}
tbody tr:hover{background:rgba(59,130,246,.05)}

.ft{margin-top:24px;text-align:center;color:#475569;font-size:11px;line-height:1.6}

/* Tooltip */
#tip{position:absolute;pointer-events:none;background:rgba(15,23,42,.96);border:1px solid rgba(148,163,184,.2);
  border-radius:8px;padding:8px 12px;font-size:11px;display:none;z-index:10;max-height:380px;overflow-y:auto;
  min-width:160px;box-shadow:0 8px 32px rgba(0,0,0,.4)}
#tip .th{color:#94a3b8;font-size:11px;font-weight:600;letter-spacing:.7px;text-transform:uppercase;margin-bottom:4px}
#tip .tr{display:flex;align-items:center;gap:6px;padding:1.5px 0}
#tip .td{width:7px;height:7px;border-radius:50%;flex-shrink:0}
#tip .tn{color:#e2e8f0;flex:1;font-size:11px}
#tip .tv{color:#f8fafc;font-weight:600;font-family:monospace;white-space:nowrap;font-size:11px}

@media(min-width:641px){
  .ctr{padding:20px 16px 40px}
  .hdr h1{font-size:24px}
  .tab{padding:10px 18px;font-size:13px}
  .chk-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
}
</style>
</head>
<body>
<div class="ctr">
  <div class="hdr"><div class="hdr-text"><h1 id="pt"></h1><p class="sub" id="ps"></p></div><div class="lp" id="lp"></div></div>
  <div class="sel-toggle" id="seltog"></div>
  <div class="sel-panel" id="selpan"></div>
  <div class="cc" id="ccw"><canvas id="cv"></canvas><div id="tip"></div></div>
  <div class="lc"><div class="lh" id="lht"></div><div class="lg" id="lgd"></div></div>
  <div class="tabs" id="tabs"></div>
  <div id="p0" class="panel show"></div>
  <div id="p1" class="panel"></div>
  <div id="p2" class="panel"></div>
  <div id="p3" class="panel about"></div>
  <div class="ft" id="ftr"></div>
</div>
<script>
(function(){
"use strict";

/* ═══════════════════════════════════════════════════════════════
   DATA — ~45 countries, GDP per capita PPP (const 2021 intl $)
   Source: World Bank WDI NY.GDP.PCAP.PP.KD, IMF WEO
   Values in thousands. 21 points: 2004-2024.
   ═══════════════════════════════════════════════════════════════ */
var YR=[];for(var y=2004;y<=2024;y++)YR.push(y);

var D={
"Luxembourg":[95.8,97.6,101.8,107.3,104.2,99.1,103.8,106,105.5,109.7,114.5,115.9,118.1,117.7,118.5,120.3,117.5,122.3,121.5,124.8,127.6],
"Singapore":[63.2,67.5,72.1,77.5,73.7,72.5,82.9,87.2,88.9,92.8,95.7,97.5,100.2,104.7,107.2,107.6,104,112.8,116,116.5,119.2],
"Ireland":[51.8,53.5,55.2,57.2,53.4,52.3,53.3,55.8,55.4,56.5,71.2,95.3,96.4,103.1,108.1,112.4,117.8,133.2,128.9,118.5,117],
"Qatar":[110.5,108.3,116,118.7,122.4,112.8,125.5,134.2,131.3,132.4,131,123.1,118.4,112.6,112,111.5,102.3,103.8,110.2,105.4,100.8],
"Macao":[52.4,55.8,62.8,71.5,74.6,74,89.2,100.8,107.2,112.4,107.3,96.7,96.2,103.5,100.3,92.3,42.1,54.3,30.5,65.4,82.5],
"Switzerland":[62,63.1,65.8,68.3,66.2,65,67,67.8,68.2,69.3,71,72.1,73.3,74.3,76.2,77.5,75,79.8,81,81.5,82],
"Norway":[67.5,68.2,69.4,70.8,70.4,68.9,69.3,69.6,71.4,72,73.2,74.5,75,76.5,77,77.8,76.5,80.2,81.8,82.4,82],
"United States":[54.8,56.2,57.5,58.3,57.8,55.9,57.3,58.2,59.3,60.2,61.6,63.1,64,65.2,67,68.4,66.1,69.8,71.5,73.4,75.8],
"UAE":[67.2,64.8,68.5,65.2,64,61.3,61.8,63.2,63.7,66.2,67.8,69,70.5,69.8,70.2,72.4,67.8,68.5,73.2,74,73.5],
"Hong Kong":[43.5,46.2,48.5,51.2,49.8,48,51.5,53.2,53.8,56.1,58,59.5,60.8,63.2,64.5,62.8,55.8,62.3,59.4,63.8,66],
"Denmark":[50.2,51.3,53,53.2,51.8,49.8,51,52,52.3,53,54.2,55.5,57.5,59.2,60.5,62,59.8,64.2,67.5,68,69.5],
"Netherlands":[49.5,50.8,52.5,54.2,53,51.2,51.8,52.8,52.2,53,54.2,55.5,56.5,58.2,59.8,61.2,58.2,63.5,68,68.5,69],
"Taiwan":[36.2,38,40,42.5,41.8,39.5,47.2,51,52.5,54,56.2,56.5,57.8,60.2,62,64.5,66.8,70.2,71.5,67.8,70],
"Iceland":[47,49.5,49.8,50.5,50.8,47.2,44.5,46.2,47.5,50,51.8,53.5,57.2,59,61.2,63,58.8,63,68.3,70.5,68.5],
"Sweden":[45.8,47,48.8,50,49.2,46.8,49.2,50.5,50,51.2,52.5,55,55.8,56.5,57.5,58.8,57,60.2,63.2,63,63.8],
"Austria":[46.2,47,48.5,50.2,49,46,47,48.3,48.8,48.5,49.2,50,51.5,52.5,54,55.2,51.8,55.8,58.8,58.5,59.2],
"Germany":[43,43.5,45.8,47.5,47.8,45,47,49.2,49.5,49.8,51.2,51.8,52.8,54.5,55.2,56,53.5,55.8,57.8,57.5,58],
"Belgium":[44.2,45,46,47.2,46.8,45.5,46.5,47.2,47.5,47.5,48.8,49.5,50,51,52,53.2,50.8,54.5,57.2,57.8,58.5],
"Australia":[45.5,46.5,47.2,48.5,49,49.5,50,51,52.5,53,53.8,54.5,55.5,56,57,57.8,57,59.5,61,62.5,62.8],
"Canada":[45.5,46.2,47,47.5,47.5,45.8,46.8,48,48.5,49.5,50.5,50.8,51.2,52.5,53.8,54.2,51.8,53.5,55,56,56.5],
"France":[38.5,39.2,40,41.2,41,39.8,40.2,41,41.2,41.5,42,42.5,43,43.8,44.5,45.8,44.2,47.2,49,49.2,49.8],
"United Kingdom":[39.8,40.8,41.5,42,41.8,39.5,40.2,40.8,41.2,42.5,43.2,44,44.8,45.5,46.2,47,43.5,47.8,49.2,49.5,50.5],
"Japan":[35.8,36.5,37,38,37.2,35.5,37.5,38.2,39,39.8,40,40.2,40.5,41.5,42,42.5,41,42.5,43.2,44,45.2],
"Italy":[41.5,41.8,42.5,43.2,42.5,40,40.5,40.8,39.2,39,39.5,40,41,41.8,42.5,43.2,40.2,44.5,47,47.2,47.5],
"Spain":[32.8,34,35.5,36.2,35.8,34.5,34,33.8,33.2,33.8,34.8,36.2,37.5,38.5,39.5,40.2,38.5,41.5,43.8,44.5,45.2],
"South Korea":[28,29.5,31,32.5,33.5,33.8,35.8,37,38,39.5,40.5,41.8,43,44.5,45.8,46.5,46,48.2,49.5,50.5,51.8],
"Israel":[30.5,31.2,32.5,34,35,33.5,35.5,37,38,39.5,40.8,41.2,42.5,43.8,45,45.8,44.5,48,50.2,51.5,49.8],
"New Zealand":[33.2,34,34.5,35.5,35,34,35,35.8,36.5,37,38,38.5,39.5,40.5,41.5,42,40,42.5,43.8,43.5,43.8],
"Czech Republic":[25.2,26.5,28,30,30.5,29,30.5,31.2,31,31.5,33.2,34.8,35.5,37,38.5,39.5,37.8,39,41.5,42.8,44.5],
"Poland":[17.5,18.2,19.5,21,22,22.5,23.5,24.8,25.2,25.5,26.8,28,29,30.5,32.2,34,33.5,36.5,39.2,39.8,41],
"Portugal":[27,27.5,28,28.8,28.5,27.5,28,27.5,27,27.2,28,29,30.5,31.8,33,34,32.2,34.5,36.5,37.5,38.5],
"Greece":[28.5,28.8,30.2,30.5,29.5,27.5,24.8,22,20.5,20.2,20.8,21,21.5,22,23,24.2,22.5,26,28.5,29,30.2],
"Saudi Arabia":[41.5,42.5,43,43.5,45,43.5,44.5,48,48.5,49,49.5,51,51.5,50.8,52.5,52.8,49.2,50.8,55,54.5,53.8],
"Kuwait":[75.5,77.5,78,76,74.5,68.2,66.5,69,72,70.5,70.2,68,67,61.5,59,58.5,52,52.5,57,54,52.5],
"Bahrain":[44,45.5,47,48.2,48.5,47,47.8,48.2,49.2,50.5,51,51.2,52,53.5,54,54.5,49.5,51.5,55.5,57,58],
"Finland":[41.5,42.5,44.2,46.2,45.8,41.8,43.2,44.5,43.5,43.2,43,43.8,44.8,46,46.5,47.5,46,48.2,49.5,49,49.5],
"China":[5.2,5.8,6.6,7.6,8.2,9,10,10.8,11.8,12.5,13.2,13.8,14.5,15.5,16.5,17.2,17.5,18.8,19.8,20.8,21.8],
"India":[3.2,3.5,3.8,4.2,4.4,4.8,5.2,5.5,5.8,6.2,6.6,7,7.5,8,8.2,8.5,7.8,8.5,8.8,9.2,9.8],
"Brazil":[12.8,13.2,13.8,14.5,15.2,15,16,16.5,16.8,17.2,17,16.5,16,16.2,16.5,16.8,16,17,17.8,18.2,18.5],
"Russia":[18.2,19.5,21.2,23,24.5,22.5,23.5,25,26.2,27,27.2,26.5,26.2,27,28.2,29.5,28.8,30.2,29,31.5,32.8],
"South Africa":[11,11.5,12,12.5,12.8,12.2,12.5,13,13.2,13.5,13.2,13,13.2,13.5,13.8,13.5,12.5,13.2,13.5,13.8,14],
"Mexico":[17,17.5,18.5,18.8,19.2,17.8,18.2,18.5,19.2,19,19.8,20.2,20.5,21,21.2,21,18.8,19.8,21,21.8,22],
"Turkey":[17.5,18.8,20,21.2,21.5,20.5,22.5,24,23.5,25,26,27,28.2,29.5,29,30.2,30.8,33.5,35.2,35.8,36.5],
"Argentina":[15.2,16.2,17,18,18.5,18,19.5,20.2,19.8,20.5,19.8,20.2,19.5,20.2,19.5,19,18.2,19.5,20.2,17.5,19.2],
"Chile":[16.5,17.2,18,18.8,19.5,19.2,20.2,21,21.5,22,22.2,22.8,23,23.5,24.5,24,22,24.5,25.2,25,25.5],
"Hungary":[22,23,24,24.5,25.2,23.5,23.8,24.2,24,25,26.2,27.5,28,29.5,31.2,33,32.5,34,36.5,36,37.5]
};

/* Country display names in French */
var FN={
"Luxembourg":"Luxembourg","Singapore":"Singapour","Ireland":"Irlande","Qatar":"Qatar","Macao":"Macao",
"Switzerland":"Suisse","Norway":"Norv\u00e8ge","United States":"\u00c9tats-Unis","UAE":"\u00c9mirats arabes unis",
"Hong Kong":"Hong Kong","Denmark":"Danemark","Netherlands":"Pays-Bas","Taiwan":"Ta\u00efwan","Iceland":"Islande",
"Sweden":"Su\u00e8de","Austria":"Autriche","Germany":"Allemagne","Belgium":"Belgique","Australia":"Australie",
"Canada":"Canada","France":"France","United Kingdom":"Royaume-Uni","Japan":"Japon","Italy":"Italie",
"Spain":"Espagne","South Korea":"Cor\u00e9e du Sud","Israel":"Isra\u00ebl","New Zealand":"Nouvelle-Z\u00e9lande",
"Czech Republic":"Tch\u00e9quie","Poland":"Pologne","Portugal":"Portugal","Greece":"Gr\u00e8ce",
"Saudi Arabia":"Arabie saoudite","Kuwait":"Kowe\u00eft","Bahrain":"Bahre\u00efn","Finland":"Finlande",
"China":"Chine","India":"Inde","Brazil":"Br\u00e9sil","Russia":"Russie","South Africa":"Afrique du Sud",
"Mexico":"Mexique","Turkey":"Turquie","Argentina":"Argentine","Chile":"Chili","Hungary":"Hongrie"
};

var PAL=["#E63946","#1D3557","#2A9D8F","#F4A261","#6A0572",
"#457B9D","#E76F51","#264653","#A7C957","#BC6C25",
"#0077B6","#D62828","#F77F00","#023047","#219EBC",
"#8338EC","#FF006E","#3A86FF","#FB5607","#FFBE0B",
"#06D6A0","#118AB2","#EF476F","#FFD166","#073B4C",
"#9B5DE5","#F15BB5","#00BBF9","#00F5D4","#FEE440"];

/* ═══ Groups ═══ */
var GROUPS={
  "Top 10":null, /* special: computed */
  "Top 20":null,
  "G7":["United States","Canada","United Kingdom","France","Germany","Italy","Japan"],
  "EU-Core":["France","Germany","Italy","Spain","Netherlands","Belgium","Austria","Ireland","Finland","Portugal","Greece","Luxembourg"],
  "Nordics":["Norway","Sweden","Denmark","Finland","Iceland"],
  "BRICS":["Brazil","Russia","India","China","South Africa"],
  "Gulf":["Qatar","UAE","Saudi Arabia","Kuwait","Bahrain"],
  "East Asia":["China","Japan","South Korea","Taiwan","Hong Kong","Singapore","Macao"],
  "Anglosphere":["United States","United Kingdom","Canada","Australia","New Zealand","Ireland"]
};

var GROUPS_FR={
  "Top 10":"Top 10","Top 20":"Top 20","G7":"G7","EU-Core":"UE-Coeur","Nordics":"Nordiques",
  "BRICS":"BRICS","Gulf":"Golfe","East Asia":"Asie de l\u2019Est","Anglosphere":"Anglophonie"
};

/* ═══ i18n ═══ */
var II={
en:{
t:"GDP per Capita, PPP",ts:"(const. 2021 intl $)",
ds:"World Bank WDI (NY.GDP.PCAP.PP.KD), IMF WEO \u2014 2004\u20132024",
lh:"Click a country to highlight",
xl:"Year",yl:"GDP per Capita ($k, const. 2021 intl $)",
tabs:["","Analysis","Data Table","About"],
selBtn:"Select Countries",hideBtn:"Hide",
selCount:" selected",clearAll:"Clear All",
dl:"Definition",
dt:"GDP per capita based on purchasing power parity (PPP), expressed in constant 2021 international dollars. PPP conversion factors account for price-level differences across countries; constant prices adjust for inflation over time.",
sl:"Sources",
st:"World Bank World Development Indicators (NY.GDP.PCAP.PP.KD); International Comparison Program (ICP); IMF World Economic Outlook. Compiled early 2025.",
sn:"Note: Some jurisdictions (Ireland, Luxembourg, Singapore) have figures influenced by multinational corporate accounting.",
at:"Key Observations",
a:[
["Luxembourg stays on top","Luxembourg has consistently held the #1 or #2 position, reflecting a small population and massive financial services sector."],
["Qatar\u2019s decline from peak","Qatar led globally in 2010\u20132013 (above $134k) driven by gas revenues. Population growth has since reduced per-capita output."],
["Ireland\u2019s \u2018leprechaun economics\u2019","Ireland\u2019s leap around 2015 reflects multinationals reclassifying IP assets through Irish subsidiaries, inflating GDP. Ireland created GNI* as an alternative."],
["Macao\u2019s COVID collapse","Macao, dependent on casinos, saw GDP per capita fall from $100k+ to ~$30k during pandemic lockdowns."],
["Taiwan\u2019s steady ascent","Taiwan nearly doubled from ~$36k to ~$70k, driven by TSMC and diversified tech exports."],
["France in context","France at ~$50k sits solidly mid-pack among Western European peers \u2014 above Spain and Italy, below Germany and the Nordics. Growth has been steady but modest."],
["US pulling ahead","The U.S. at ~$76k has accelerated past European peers post-2020, driven by the tech sector and productivity growth."]
],
an:"GDP per capita (PPP) is a useful but imperfect proxy for living standards.",
bw:"Data from World Bank & IMF",
tblCountry:"Country",tblGrowth:"Growth",tblLatest:"Latest"
},
fr:{
t:"PIB par habitant (PPA)",ts:"($ intl const. 2021)",
ds:"Banque mondiale IDM (NY.GDP.PCAP.PP.KD), FMI PEM \u2014 2004\u20132024",
lh:"Cliquez sur un pays pour le mettre en surbrillance",
xl:"Ann\u00e9e",yl:"PIB/hab. ($k, intl const. 2021)",
tabs:["","Analyse","Tableau","\u00c0 propos"],
selBtn:"S\u00e9lectionner des pays",hideBtn:"Masquer",
selCount:" s\u00e9lectionn\u00e9(s)",clearAll:"Tout effacer",
dl:"D\u00e9finition",
dt:"PIB par habitant en PPA, en dollars internationaux constants de 2021. Les facteurs PPA corrigent les diff\u00e9rences de prix entre pays ; les prix constants corrigent l\u2019inflation.",
sl:"Sources",
st:"Banque mondiale, IDM (NY.GDP.PCAP.PP.KD) ; PCI ; FMI, PEM. Compil\u00e9es d\u00e9but 2025.",
sn:"Remarque : Certaines juridictions (Irlande, Luxembourg, Singapour) ont des chiffres influenc\u00e9s par la comptabilit\u00e9 des multinationales.",
at:"Observations cl\u00e9s",
a:[
["Le Luxembourg reste en t\u00eate","Le Luxembourg occupe syst\u00e9matiquement la 1re ou 2e place, gr\u00e2ce \u00e0 une petite population et un secteur financier massif."],
["Le d\u00e9clin du Qatar","Le Qatar dominait en 2010\u20132013 (au-dessus de 134 000 $) gr\u00e2ce au gaz. La croissance d\u00e9mographique a r\u00e9duit le PIB par habitant."],
["La \u00ab leprechaun economics \u00bb de l\u2019Irlande","Le bond de l\u2019Irlande vers 2015 refl\u00e8te la reclassification d\u2019actifs par les multinationales. L\u2019Irlande a cr\u00e9\u00e9 le RNB* comme alternative."],
["L\u2019effondrement de Macao","Macao, d\u00e9pendant des casinos, a vu son PIB/hab. passer de 100 000+ $ \u00e0 ~30 000 $ pendant la pand\u00e9mie."],
["L\u2019ascension de Ta\u00efwan","Ta\u00efwan a presque doubl\u00e9, de ~36 000 $ \u00e0 ~70 000 $, port\u00e9 par TSMC et les exportations tech."],
["La France en contexte","La France \u00e0 ~50 000 $ se situe solidement au milieu des pays europ\u00e9ens \u2014 au-dessus de l\u2019Espagne et de l\u2019Italie, en dessous de l\u2019Allemagne et des pays nordiques. Croissance r\u00e9guli\u00e8re mais modeste."],
["Les \u00c9tats-Unis se d\u00e9tachent","Les \u00c9.-U. \u00e0 ~76 000 $ ont acc\u00e9l\u00e9r\u00e9 par rapport \u00e0 l\u2019Europe apr\u00e8s 2020, port\u00e9s par la tech et la productivit\u00e9."]
],
an:"Le PIB par habitant (PPA) est un indicateur utile mais imparfait du niveau de vie.",
bw:"Donn\u00e9es de la Banque mondiale et du FMI",
tblCountry:"Pays",tblGrowth:"Croissance",tblLatest:"Dernier"
}
};

/* ═══ STATE ═══ */
var lang="en",hiC=null,activeTab=0,selOpen=false,activeGroup=null;
var AK=Object.keys(D);
AK.sort(function(a,b){return D[b][20]-D[a][20]});

/* Top N computed */
function topN(n){return AK.slice(0,n)}

/* Selected countries */
var selected=topN(10).slice();

function dn(c){return lang==="fr"?(FN[c]||c):c}

/* Assign colors dynamically to selected */
function getColorMap(){
  var m={};
  selected.forEach(function(c,i){m[c]=PAL[i%PAL.length]});
  return m;
}

/* ═══ CANVAS CHART ═══ */
var cv=document.getElementById("cv"),ctx=cv.getContext("2d"),tip=document.getElementById("tip");
var dpr=window.devicePixelRatio||1;
var PAD={t:16,r:10,b:44,l:52};
var pw,ph,cw,ch;

function resize(){
  var box=cv.parentElement;
  var mob=window.innerWidth<640;
  var h=mob?320:480;
  cw=box.clientWidth-20; ch=h;
  cv.width=cw*dpr; cv.height=ch*dpr;
  cv.style.width=cw+"px"; cv.style.height=ch+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
  pw=cw-PAD.l-PAD.r; ph=ch-PAD.t-PAD.b;
}

function drawChart(){
  resize();
  var cm=getColorMap(),t=II[lang];
  if(!selected.length){ctx.clearRect(0,0,cw,ch);ctx.fillStyle="#64748b";ctx.font="14px -apple-system,sans-serif";ctx.textAlign="center";ctx.fillText(lang==="en"?"Select countries to display":"S\u00e9lectionnez des pays",cw/2,ch/2);cv._meta=null;return}
  var yMin=1e9,yMax=0;
  selected.forEach(function(c){D[c].forEach(function(v){if(v<yMin)yMin=v;if(v>yMax)yMax=v})});
  var range=yMax-yMin; if(range<10){yMin-=5;yMax+=5}
  yMin=Math.max(0,Math.floor(yMin/5)*5); yMax=Math.ceil(yMax/5)*5+2;
  ctx.clearRect(0,0,cw,ch);
  var yStep=Math.max(5,Math.round((yMax-yMin)/8/5)*5);if(yStep===0)yStep=5;
  ctx.textAlign="right"; ctx.textBaseline="middle"; ctx.font="10px -apple-system,sans-serif";
  for(var v=yMin;v<=yMax;v+=yStep){
    var py=PAD.t+ph-(v-yMin)/(yMax-yMin)*ph;
    ctx.strokeStyle="rgba(148,163,184,0.07)"; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(PAD.l,py); ctx.lineTo(PAD.l+pw,py); ctx.stroke();
    ctx.fillStyle="#94a3b8"; ctx.fillText("$"+v+"k",PAD.l-5,py);
  }
  var mob=window.innerWidth<640;
  ctx.textAlign="center"; ctx.textBaseline="top"; ctx.font="10px -apple-system,sans-serif";
  YR.forEach(function(yr,i){
    if(mob&&i%4!==0)return;if(!mob&&i%2!==0&&i!==YR.length-1)return;
    var px=PAD.l+i/(YR.length-1)*pw;
    ctx.fillStyle="#94a3b8"; ctx.fillText(yr,px,ch-PAD.b+6);
  });
  ctx.fillStyle="#64748b"; ctx.font="11px -apple-system,sans-serif";
  ctx.textAlign="center"; ctx.fillText(t.xl,PAD.l+pw/2,ch-4);
  if(!mob){ctx.save();ctx.translate(12,PAD.t+ph/2);ctx.rotate(-Math.PI/2);ctx.font="10px -apple-system,sans-serif";ctx.fillText(t.yl,0,0);ctx.restore()}
  selected.forEach(function(c){
    var isHi=hiC===c,isDim=hiC&&!isHi;
    ctx.strokeStyle=isDim?cm[c]+"28":cm[c];
    ctx.lineWidth=isHi?3.5:isDim?1:2;
    ctx.lineJoin="round"; ctx.lineCap="round"; ctx.beginPath();
    D[c].forEach(function(v,i){
      var px=PAD.l+i/(YR.length-1)*pw;
      var py=PAD.t+ph-(v-yMin)/(yMax-yMin)*ph;
      i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);
    });
    ctx.stroke();
  });
  cv._meta={cs:selected.slice(),cm:cm,yMin:yMin,yMax:yMax};
}

/* Tooltip */
function showTip(e){
  var m=cv._meta; if(!m||!m.cs.length)return;
  var rect=cv.getBoundingClientRect();
  var mx=e.clientX-rect.left,my=e.clientY-rect.top;
  var xi=Math.round((mx-PAD.l)/pw*(YR.length-1));
  if(xi<0||xi>=YR.length){tip.style.display="none";return}
  var entries=[];
  m.cs.forEach(function(c){entries.push({c:c,v:D[c][xi],col:m.cm[c]})});
  entries.sort(function(a,b){return b.v-a.v});
  var h='<div class="th">'+YR[xi]+'</div>';
  entries.forEach(function(e){h+='<div class="tr"><div class="td" style="background:'+e.col+'"></div><span class="tn">'+dn(e.c)+'</span><span class="tv">$'+e.v.toFixed(1)+'k</span></div>'});
  tip.innerHTML=h; tip.style.display="block";
  var tx=mx+14,ty=my-16;
  if(tx+tip.offsetWidth>cw)tx=mx-tip.offsetWidth-10;
  if(ty<0)ty=4; if(ty+tip.offsetHeight>ch)ty=ch-tip.offsetHeight-4;
  tip.style.left=tx+"px"; tip.style.top=ty+"px";
  drawChart();
  var px=PAD.l+xi/(YR.length-1)*pw;
  ctx.strokeStyle="rgba(148,163,184,0.18)"; ctx.lineWidth=1; ctx.setLineDash([4,4]);
  ctx.beginPath(); ctx.moveTo(px,PAD.t); ctx.lineTo(px,PAD.t+ph); ctx.stroke(); ctx.setLineDash([]);
  m.cs.forEach(function(c){
    var v=D[c][xi],isDim=hiC&&hiC!==c;
    var py=PAD.t+ph-(v-m.yMin)/(m.yMax-m.yMin)*ph;
    ctx.fillStyle=isDim?m.cm[c]+"28":m.cm[c];
    ctx.beginPath(); ctx.arc(px,py,3,0,Math.PI*2); ctx.fill();
  });
}
cv.addEventListener("mousemove",showTip);
cv.addEventListener("touchmove",function(e){e.preventDefault();showTip({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY})},{passive:false});
cv.addEventListener("mouseleave",function(){tip.style.display="none";drawChart()});
cv.addEventListener("touchend",function(){tip.style.display="none";drawChart()});

/* ═══ SELECTOR PANEL ═══ */
function buildSelector(){
  var t=II[lang];
  /* Toggle button row */
  var tog=document.getElementById("seltog");
  tog.innerHTML='<button class="b pri" id="selTogBtn">'+(!selOpen?("\u25BC "+t.selBtn):("\u25B2 "+t.hideBtn))+'</button><span class="sel-count">'+selected.length+t.selCount+'</span>';
  document.getElementById("selTogBtn").addEventListener("click",function(){selOpen=!selOpen;buildSelector()});

  var pan=document.getElementById("selpan");
  pan.className="sel-panel"+(selOpen?" open":"");
  if(!selOpen){pan.innerHTML="";return}

  /* Group buttons */
  var gHtml='<div class="grp-row" id="grpRow"></div>';
  /* Clear all */
  gHtml+='<div style="display:flex;justify-content:flex-end;margin-bottom:6px"><button class="b" id="clrBtn" style="font-size:10px;padding:3px 10px">'+t.clearAll+'</button></div>';
  gHtml+='<div class="chk-grid" id="chkGrid"></div>';
  pan.innerHTML=gHtml;

  /* Group buttons */
  var gr=document.getElementById("grpRow");
  Object.keys(GROUPS).forEach(function(g){
    var btn=document.createElement("button");
    btn.className="grp"+(activeGroup===g?" on":"");
    btn.textContent=lang==="fr"?(GROUPS_FR[g]||g):g;
    btn.addEventListener("click",function(){
      activeGroup=(activeGroup===g)?null:g;
      if(activeGroup){
        if(g==="Top 10")selected=topN(10).slice();
        else if(g==="Top 20")selected=topN(20).slice();
        else selected=(GROUPS[g]||[]).slice();
      }
      hiC=null; refresh();
    });
    gr.appendChild(btn);
  });

  /* Clear button */
  document.getElementById("clrBtn").addEventListener("click",function(){selected=[];activeGroup=null;hiC=null;refresh()});

  /* Checkboxes — sorted alphabetically by display name */
  var grid=document.getElementById("chkGrid");
  var sorted=AK.slice().sort(function(a,b){return dn(a).localeCompare(dn(b))});
  sorted.forEach(function(c){
    var label=document.createElement("label");
    label.className="chk-item"+(selected.indexOf(c)>=0?" hi":"");
    var cb=document.createElement("input");
    cb.type="checkbox"; cb.checked=selected.indexOf(c)>=0;
    cb.addEventListener("change",function(){
      activeGroup=null;
      if(cb.checked){if(selected.indexOf(c)<0)selected.push(c)}
      else{var idx=selected.indexOf(c);if(idx>=0)selected.splice(idx,1)}
      hiC=null; refresh();
    });
    label.appendChild(cb);
    label.appendChild(document.createTextNode(" "+dn(c)));
    grid.appendChild(label);
  });
}

/* ═══ LEGEND ═══ */
function buildLeg(){
  var cm=getColorMap(),el=document.getElementById("lgd");el.innerHTML="";
  selected.forEach(function(c){
    var d=document.createElement("div");
    d.className="li"+(hiC===c?" on":(hiC&&hiC!==c?" dim":""));
    d.innerHTML='<div class="ls" style="background:'+cm[c]+'"></div><span class="ln">'+dn(c)+'</span><span class="lv">$'+Math.round(D[c][20])+'k</span>';
    d.addEventListener("click",function(){hiC=(hiC===c)?null:c;drawChart();buildLeg()});
    el.appendChild(d);
  });
}

/* ═══ LANG ═══ */
function buildLang(){
  var el=document.getElementById("lp"); el.innerHTML="";
  ["EN","FR"].forEach(function(l){
    var b=document.createElement("button");
    b.textContent=l; b.className=(lang==="en"&&l==="EN")||(lang==="fr"&&l==="FR")?"on":"";
    b.addEventListener("click",function(){lang=l==="EN"?"en":"fr";render()});
    el.appendChild(b);
  });
}

/* ═══ TABS ═══ */
function buildTabs(){
  var t=II[lang],el=document.getElementById("tabs");el.innerHTML="";
  var icons=["\ud83d\udcc8","\ud83d\udd0d","\ud83d\udcca","\u2139\ufe0f"];
  var labels=t.tabs;
  var panIds=["p0","p1","p2","p3"];
  labels.forEach(function(label,i){
    var b=document.createElement("button");
    b.className="tab"+(activeTab===i?" on":"");
    b.textContent=icons[i]+(label?" "+label:"");
    b.addEventListener("click",function(){
      activeTab=i;
      panIds.forEach(function(p,j){document.getElementById(p).className="panel"+(j===i?" show":"")});
      buildTabs();
      if(i===0)drawChart();
      if(i===2)buildTable();
    });
    el.appendChild(b);
  });
}

/* ═══ ANALYSIS ═══ */
function buildAnalysis(){
  var t=II[lang],el=document.getElementById("p1");
  var h="<h2 style='font-size:18px;font-weight:700;margin-bottom:16px'>"+t.at+"</h2>";
  t.a.forEach(function(x,i){h+='<div class="ai"><h3>'+(i+1)+". "+x[0]+"</h3><p>"+x[1]+"</p></div>"});
  h+='<p class="an">'+t.an+"</p>";
  el.innerHTML=h;
}

/* ═══ DATA TABLE ═══ */
var tblSort={col:20,asc:false};
function buildTable(){
  var t=II[lang],el=document.getElementById("p2");
  if(!selected.length){el.innerHTML="<p style='color:#64748b;padding:20px'>"+
    (lang==="en"?"Select countries above to see data.":"S\u00e9lectionnez des pays ci-dessus.")+"</p>";return}
  var rows=selected.slice();
  rows.sort(function(a,b){
    var va,vb;
    if(tblSort.col===-1){va=dn(a);vb=dn(b);return tblSort.asc?va.localeCompare(vb):vb.localeCompare(va)}
    if(tblSort.col===-2){/* growth */
      va=(D[a][20]-D[a][0])/D[a][0]*100; vb=(D[b][20]-D[b][0])/D[b][0]*100;
    } else {va=D[a][tblSort.col];vb=D[b][tblSort.col]}
    return tblSort.asc?va-vb:vb-va;
  });

  var h='<div class="tbl-wrap"><table><thead><tr>';
  /* Country col */
  h+=thHtml(-1,t.tblCountry);
  /* Year cols — show subset on mobile */
  var mob=window.innerWidth<640;
  var showYrs=mob?[0,4,8,12,16,20]:[0,2,4,6,8,10,12,14,16,18,20];
  showYrs.forEach(function(i){h+=thHtml(i,YR[i])});
  h+=thHtml(-2,t.tblGrowth);
  h+="</tr></thead><tbody>";

  rows.forEach(function(c){
    var cm=getColorMap();
    h+="<tr><td><span style='display:inline-block;width:8px;height:8px;border-radius:50%;background:"+(cm[c]||"#475569")+";margin-right:6px;vertical-align:middle'></span>"+dn(c)+"</td>";
    showYrs.forEach(function(i){h+="<td>$"+D[c][i].toFixed(1)+"k</td>"});
    var g=((D[c][20]-D[c][0])/D[c][0]*100);
    h+="<td style='color:"+(g>=0?"#2A9D8F":"#E63946")+"'>"+g.toFixed(1)+"%</td></tr>";
  });
  h+="</tbody></table></div>";
  el.innerHTML=h;

  /* Sort click handlers */
  el.querySelectorAll("th").forEach(function(th){
    th.addEventListener("click",function(){
      var col=parseInt(th.getAttribute("data-col"));
      if(tblSort.col===col)tblSort.asc=!tblSort.asc;
      else{tblSort.col=col;tblSort.asc=col===-1}
      buildTable();
    });
  });
}
function thHtml(col,label){
  var arrow=tblSort.col===col?(tblSort.asc?" <span class='arr'>\u25B2</span>":" <span class='arr'>\u25BC</span>"):"";
  return "<th data-col='"+col+"'>"+label+arrow+"</th>";
}

/* ═══ ABOUT ═══ */
function buildAbout(){
  var t=II[lang],el=document.getElementById("p3");
  el.innerHTML="<p><strong>"+t.dl+" :</strong> "+t.dt+"</p>"+
    "<p class='src'><strong>"+t.sl+" :</strong> "+t.st+"</p>"+
    "<p class='src' style='margin-top:6px;font-style:italic'>"+t.sn+"</p>";
}

/* ═══ RENDER ═══ */
function render(){
  var t=II[lang];
  document.getElementById("pt").innerHTML=t.t+"<span>"+t.ts+"</span>";
  document.getElementById("ps").textContent=t.ds;
  document.getElementById("lht").textContent=t.lh;
  document.getElementById("ftr").innerHTML="<p>"+t.bw+"</p><p style='margin-top:3px'>\u00a9 "+new Date().getFullYear()+" Corey Prator</p>";
  document.documentElement.lang=lang;
  buildLang(); buildSelector(); drawChart(); buildLeg();
  buildTabs(); buildAnalysis(); buildTable(); buildAbout();
}

function refresh(){
  buildSelector(); drawChart(); buildLeg();
  /* rebuild table if visible */
  if(activeTab===2)buildTable();
  /* update count */
  var t=II[lang];
  var cnt=document.querySelector(".sel-count");
  if(cnt)cnt.textContent=selected.length+t.selCount;
}

window.addEventListener("load",render);
var rt;window.addEventListener("resize",function(){clearTimeout(rt);rt=setTimeout(function(){drawChart();if(activeTab===2)buildTable()},120)});
})();
</script>
</body>
</html>
